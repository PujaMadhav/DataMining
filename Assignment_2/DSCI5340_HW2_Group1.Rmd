---
title: "DSCI5340_HW2_SP24_Group1"
subtitle: Divya Laxmi Yedanpuri Imran Nawaz Shareef Kethana Elavarthi Puja Madhav 
output:
  pdf_document: default
  html_document: default
date: "2024-02-16"
---

```{r}

library(fpp3)
library(forecast)
search()

```

```{r}

us_gasoline

```
Description: First, the above code chunks loads a package called "fpp3" and the "forecast" and a data set called "us_gasoline" This data set contains information of Weekly data beginning Week 6, 1991, ending Week 3, 2017, with 1355 rows and two columns: the 'Week' and the supply of us_gas 'Barrels'.

# Subsetting the data until the end of 2004:

```{r}

# Setting the training data from 1991 Week 6 to 2004 Week 53
us_gas_2004 <- us_gasoline %>%
  filter_index("1991 Week 6" ~ "2004 Week 53")  %>%
  select(Week, Barrels)
us_gas_2004

```

```{r}

autoplot(us_gas_2004, color = "orange" ) +
  labs(y = "Barrels",
       x = "Week",
    title = "US Gas Supply: 1991 W06 - 2004 Week53\nObserved Data")

```
Description: The above code chunks subset the us_gasoline data set using the filter_index() function from Week 06, 1991 to Week 53, 2004. Next, the code uses the "autoplot()" function to create a graph that visualizes the data from the subsetted "us_gas_2004" data set. This graph helps to understand how gas supply have changed over time.


Q1. Fit a harmonic regression with trend to the above data. Experiment with changing
the number Fourier terms up to 10. Select the appropriate number of Fourier terms to
include by minimizing the AICc.


```{r}
fourier_us_gas_2004_k2 <- us_gas_2004 |>
  model(TSLM(Barrels ~ trend() + fourier(K = 2)))
report(fourier_us_gas_2004_k2)
```
```{r}
glance(fourier_us_gas_2004_k2) %>%
  select(adj_r_squared, CV, AIC, AICc, BIC)
```

```{r}

fourier_us_gas_2004_k3 <- us_gas_2004 %>%
  model(TSLM(Barrels ~ trend() + fourier(K = 3)))
report(fourier_us_gas_2004_k3)
```
```{r}
glance(fourier_us_gas_2004_k3) %>%
  select(adj_r_squared, CV, AIC, AICc, BIC)
```

```{r}
fourier_us_gas_2004_k7 <- us_gas_2004 %>%
  model(TSLM(Barrels ~ trend() + fourier(K = 7)))
report(fourier_us_gas_2004_k7)
```
```{r}
glance(fourier_us_gas_2004_k7) %>%
  select(adj_r_squared, CV, AIC, AICc, BIC)
```

```{r}
fourier_us_gas_2004_k10 <- us_gas_2004 %>%
  model(TSLM(Barrels ~ trend() + fourier(K = 10)))
report(fourier_us_gas_2004_k10)
```
```{r}
glance(fourier_us_gas_2004_k10) %>%
  select(adj_r_squared, CV, AIC, AICc, BIC)
```
Description: For fitting a harmonic regression to the us_gas_2004 data, we are experimenting with the fourier terms with k values from 1 to 10. Experimenting with all the k values, we present the AICc values for (k = 2,3,7,10). Among, fourier_us_gas_2004_k2(k=2), fourier_us_gas_2004_k3(k=3), fourier_us_gas_2004_k7(k=7), and fourier_us_gas_2004_k10(k=10), we conclude that fourier_us_gas_2004_k7(k=7) has low AICc, stating this could be  a better model for all the values of k.



Q2. Plot the observed gasoline and fitted values. How would you characterize the fitted
values?


```{r}

us_gas_2004 %>%
  autoplot(Barrels, color='orange') +
  autolayer(fitted(fourier_us_gas_2004_k7), color='black') +
  xlab("Week") + ylab("Barrels") +
  ggtitle("US Gas Supply Chart with fourier_us_gas_2004_k7\nFitted Vs Observed")

```
Description: For this question, the code is plotting the graph for "fitted value VS Observed Data" for fourier_us_gas_2004_k7, The orange line is the observed data and the black line is the fitted data, we can see that there is no much difference between the observed data pattern and the fitted data till the period of 2004.

Q3. Check the residuals of the final model using the `gg_tsresiduals()` function.
Describe the patterns in various charts generated by this function.


```{r}
fourier_us_gas_2004_k7 %>% gg_tsresiduals()
```
Description: The above code produce the residual diagnostic graphs using the gg_tsresiduals() function, which produces a time plot, ACF plot and histogram of the residuals. We can see that the innovation residual chart has mean close to 0  and the variance is almost constant with some outliers, but, among all the 26 vertical lines in the ACF plot, 2 of them lies outside the blue line which is more than the 5% threshold interpreting that there is auto correlation. Although, the histogram of the residual plot is normal distributed, it's not exhibiting all the properties of classifying it as a white noise, suggesting some information is still left to be picked by the model for good forecasting.


Q4. Use a Ljung-Box test to check for residual autocorrelation. What is your conclusion
using the results from this test?


```{r}
augment(fourier_us_gas_2004_k7) %>% 
  features(.innov, ljung_box, lag=104, dof=5) 
```
Description: We are using the Ljung-Box test to check for residual autocorrelation for the fourier_us_gas_2004_k7 term, and got the p-value 0.002071773, which is less than 0.05, it suggests that there is evidence to reject the null hypothesis that the residuals are uncorrelated (white noise). In other words, a low p-value indicates the presence of residual autocorrelation, interpreting that the model has not picked all the information required for forecasting the supply of us_gas_2004, so, we need to do further analysis.


Q5. Generate forecasts for the next year of data. Plot these along with the actual data for
2005. How good are these forecasts? Explain.

```{r}
us_gas_2005 <- us_gasoline %>% 
  filter_index("1991 W06" ~ "2005 W52") %>%
  select(c(Week, Barrels))
us_gas_2005

autoplot(us_gas_2005, color = "black" ) +
  labs(y = "Barrels",
       x = "Week",
    title = "US Gas Supply: 1991 W06 - 2005 Week52\nObserved Data")

# Generate forecasts for next 52 weeks
us_gas_2005_fc <- fourier_us_gas_2004_k7 %>% forecast(h = 52)
  autoplot(us_gas_2005_fc, color = "orange" ) +
  labs(y = "Barrels",
       x = "Week",
    title = "US Gas Supply: 2005W01 - 2005 Week52\nForecast Graph")


# Plotting the forecast for 2005 W52:
us_gas_2005 %>%
  autoplot(cex = 0.8, color = 'black') +
  labs(y = "Million barrels per day", 
       title = "US Gasoline Supply: Forecast for 2005\n2005: Observed Vs Forecast") +
  autolayer(us_gas_2005_fc, cex = 0.8, color = 'orange')
```
Description: The above code chunks give the data from the year 1991 Week 1 to Week 52, 2005. We can see that after the year 2005 has been included in the data, the observations increases to 778. The 1st chart uses the autoplot() function to plot the graph with actual data from the year 1991 to 2005. We generate the forecast for 2005, taking the value of h = 52 and forecast graph has been plotted to see the variation. We plot the graph  "Observed VS Forecast" to see the deviation of the forecast line from the observed value. We can say that there is no much difference between the observed and the forecast line drawn for the year 2005 and how the forecast has captured the seasonal pattern from the observed data. Each future value is expected to lie within the 80% to 95% prediction interval.

